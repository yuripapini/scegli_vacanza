<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scegli la tua vacanza</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg0: #07090f;
      --bg1: #0e1220;
      --accent: #f59e0b;
      --accent2: #f97316;
      --purple: #8b5cf6;
      --red: #ef4444;
      --glass: rgba(255,255,255,0.05);
      --glass-border: rgba(255,255,255,0.1);
      --text: #f1f5f9;
      --muted: rgba(241,245,249,0.45);
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'Inter', 'Segoe UI', sans-serif;
      background: var(--bg0);
      min-height: 100vh;
      color: var(--text);
      padding: 0 0 80px;
      overflow-x: hidden;
    }

    /* Animated gradient orbs in background */
    body::before, body::after {
      content: '';
      position: fixed;
      border-radius: 50%;
      filter: blur(80px);
      pointer-events: none;
      z-index: 0;
    }
    body::before {
      width: 400px; height: 400px;
      background: radial-gradient(circle, rgba(139,92,246,0.15), transparent 70%);
      top: -100px; right: -100px;
      animation: orb1 12s ease-in-out infinite alternate;
    }
    body::after {
      width: 350px; height: 350px;
      background: radial-gradient(circle, rgba(245,158,11,0.12), transparent 70%);
      bottom: 50px; left: -80px;
      animation: orb2 15s ease-in-out infinite alternate;
    }
    @keyframes orb1 { from { transform: translate(0,0) scale(1); } to { transform: translate(30px,50px) scale(1.2); } }
    @keyframes orb2 { from { transform: translate(0,0) scale(1); } to { transform: translate(-20px,-40px) scale(1.15); } }

    header {
      position: sticky; top: 0; z-index: 10;
      text-align: center;
      padding: 18px 20px 14px;
      background: rgba(7,9,15,0.85);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--glass-border);
    }

    header h1 {
      font-size: 1.35rem;
      font-weight: 900;
      letter-spacing: -0.5px;
      background: linear-gradient(135deg, #fbbf24, #f97316);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    header p { font-size: 0.75rem; color: var(--muted); margin-top: 3px; }

    /* PROGRESS */
    .progress-wrap { padding: 14px 20px 0; position: relative; z-index: 1; }

    .progress-label {
      font-size: 0.72rem; color: var(--muted); margin-bottom: 8px;
      display: flex; justify-content: space-between; font-weight: 500;
    }

    .progress-track {
      width: 100%; height: 5px;
      background: rgba(255,255,255,0.07); border-radius: 99px; overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--purple), var(--accent), var(--accent2));
      border-radius: 99px;
      transition: width 0.5s cubic-bezier(.4,0,.2,1);
      box-shadow: 0 0 10px rgba(245,158,11,0.4);
    }

    /* SCREENS */
    .screen { display: none; padding: 24px 18px; position: relative; z-index: 1; }
    .screen.active { display: block; animation: fadeUp 0.35s cubic-bezier(.4,0,.2,1) both; }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(18px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* WELCOME */
    .welcome-box { text-align: center; padding: 8px 0; }
    .welcome-box .big-emoji { font-size: 4rem; display: block; margin-bottom: 16px; filter: drop-shadow(0 0 24px rgba(245,158,11,0.4)); }
    .welcome-box h2 { font-size: 1.35rem; font-weight: 800; letter-spacing: -0.5px; margin-bottom: 6px; }
    .welcome-box p { font-size: 0.84rem; color: var(--muted); line-height: 1.6; margin-bottom: 6px; }

    .how-it-works {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 18px; padding: 18px 16px; margin: 20px 0; text-align: left;
      backdrop-filter: blur(12px);
    }

    .step-row {
      display: flex; align-items: flex-start; gap: 13px;
      font-size: 0.83rem; color: rgba(255,255,255,0.8); margin-bottom: 13px; line-height: 1.5;
    }
    .step-row:last-child { margin-bottom: 0; }

    .step-num {
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color: #1a0a00; font-weight: 900; font-size: 0.72rem;
      width: 24px; height: 24px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 1px;
      box-shadow: 0 0 10px rgba(245,158,11,0.35);
    }

    /* DEST CARD */
    .dest-header {
      display: flex; align-items: flex-start; gap: 14px;
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 20px; padding: 20px 18px; margin-bottom: 20px;
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }

    .dest-flag { flex-shrink: 0; margin-top: 6px; }
    .dest-name {
      font-size: 1.25rem; font-weight: 800; letter-spacing: -0.5px;
      background: linear-gradient(135deg, #fbbf24, #fb923c);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
      margin-bottom: 3px;
    }
    .dest-days { font-size: 0.7rem; color: var(--muted); margin-bottom: 8px; font-weight: 500; }
    .dest-desc { font-size: 0.8rem; color: rgba(255,255,255,0.7); line-height: 1.5; font-style: italic; }

    .screen-subtitle { font-size: 0.76rem; color: var(--muted); margin-bottom: 16px; text-align: center; font-weight: 500; }

    /* PARAM RATING */
    .param-card {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 16px; padding: 15px 15px 16px; margin-bottom: 12px;
      backdrop-filter: blur(12px);
      transition: border-color 0.2s;
    }
    .param-card:has(.star.selected) { border-color: rgba(245,158,11,0.3); }

    .param-label {
      font-size: 0.91rem; font-weight: 700; margin-bottom: 12px;
      display: flex; align-items: center; gap: 7px; letter-spacing: -0.2px;
    }

    .param-hint { font-size: 0.64rem; color: var(--muted); font-weight: 400; margin-left: auto; text-align: right; max-width: 120px; line-height: 1.3; }

    .stars { display: flex; gap: 8px; }

    .star {
      flex: 1; height: 42px; border-radius: 12px;
      background: rgba(255,255,255,0.04); border: 1.5px solid rgba(255,255,255,0.1);
      display: flex; align-items: center; justify-content: center;
      font-size: 1rem; cursor: pointer; transition: all 0.2s cubic-bezier(.4,0,.2,1);
      color: rgba(255,255,255,0.3); font-weight: 800;
    }

    .star:active { transform: scale(0.92); }

    .star.selected {
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-color: transparent; color: #1a0a00;
      box-shadow: 0 4px 18px rgba(245,158,11,0.45);
      transform: scale(1.06);
    }

    /* PESI */
    .screen-title {
      font-size: 1.15rem; font-weight: 800; letter-spacing: -0.5px;
      margin-bottom: 8px;
      background: linear-gradient(135deg, #fbbf24, #fb923c);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
      display: inline-block;
    }

    .weight-info {
      background: rgba(245,158,11,0.07); border: 1px solid rgba(245,158,11,0.2);
      border-radius: 14px; padding: 13px 15px; font-size: 0.79rem;
      margin-bottom: 20px; line-height: 1.6; color: rgba(255,220,100,0.9);
    }

    .weight-card {
      background: var(--glass); border: 1px solid var(--glass-border);
      border-radius: 16px; padding: 15px; margin-bottom: 10px;
      display: flex; align-items: center; justify-content: space-between; gap: 10px;
      backdrop-filter: blur(12px);
    }

    .weight-card-label { font-size: 0.89rem; font-weight: 700; flex: 1; line-height: 1.35; }

    .weight-btns { display: flex; gap: 6px; }

    .wbtn {
      width: 36px; height: 36px; border-radius: 10px;
      background: rgba(255,255,255,0.05); border: 1.5px solid rgba(255,255,255,0.1);
      color: rgba(255,255,255,0.4); font-weight: 800; font-size: 0.88rem;
      cursor: pointer; transition: all 0.2s cubic-bezier(.4,0,.2,1);
      display: flex; align-items: center; justify-content: center;
    }

    .wbtn.selected {
      background: linear-gradient(135deg, var(--red), #f97316);
      border-color: transparent; color: #fff;
      box-shadow: 0 4px 14px rgba(239,68,68,0.45); transform: scale(1.1);
    }

    .wbtn.used { opacity: 0.15; cursor: not-allowed; }

    /* RISULTATI */
    .result-card {
      background: var(--glass); border: 1px solid var(--glass-border);
      border-radius: 20px; padding: 18px 16px 16px; margin-bottom: 14px;
      position: relative; backdrop-filter: blur(16px);
      transition: transform 0.2s;
    }

    .result-card.top1 {
      border-color: rgba(251,191,36,0.5);
      background: rgba(251,191,36,0.07);
      box-shadow: 0 0 30px rgba(251,191,36,0.15), 0 0 0 1px rgba(251,191,36,0.2);
    }
    .result-card.top2 { border-color: rgba(180,180,200,0.35); background: rgba(200,200,220,0.04); }
    .result-card.top3 { border-color: rgba(205,127,50,0.35); background: rgba(205,127,50,0.05); }

    .result-rank { font-size: 1.6rem; position: absolute; top: 16px; right: 16px; }
    .result-name { font-size: 1.1rem; font-weight: 800; letter-spacing: -0.4px; margin-bottom: 3px; padding-right: 40px; }
    .result-flag { font-size: 1.3rem; margin-right: 4px; }
    .result-meta { font-size: 0.71rem; color: var(--muted); margin-bottom: 6px; font-weight: 500; }
    .result-desc { font-size: 0.77rem; color: rgba(255,255,255,0.65); margin-bottom: 14px; line-height: 1.45; font-style: italic; }

    .result-score-bar { height: 6px; background: rgba(255,255,255,0.07); border-radius: 99px; overflow: hidden; margin-bottom: 4px; }
    .result-score-fill { height: 100%; background: linear-gradient(90deg, var(--purple), var(--accent), var(--accent2)); border-radius: 99px; transition: width 0.9s cubic-bezier(.4,0,.2,1); }
    .result-pct { font-size: 0.72rem; color: var(--muted); text-align: right; margin-bottom: 12px; font-weight: 600; }

    .result-bars { display: flex; flex-direction: column; gap: 5px; }

    .bar-row { display: flex; align-items: center; gap: 8px; font-size: 0.69rem; color: rgba(255,255,255,0.6); }
    .bar-label { width: 90px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 500; }
    .bar-track { flex: 1; height: 4px; background: rgba(255,255,255,0.07); border-radius: 99px; overflow: hidden; }
    .bar-fill { height: 100%; background: linear-gradient(90deg, var(--purple), var(--accent)); border-radius: 99px; }

    /* BUTTONS */
    .btn {
      display: block; width: 100%; padding: 16px; border-radius: 16px; border: none;
      font-size: 1rem; font-weight: 700; cursor: pointer; margin-top: 14px;
      transition: all 0.2s cubic-bezier(.4,0,.2,1);
      letter-spacing: -0.2px; position: relative; overflow: hidden;
      font-family: 'Inter', 'Segoe UI', sans-serif;
    }

    .btn::after {
      content: '';
      position: absolute; inset: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.12) 0%, transparent 60%);
      pointer-events: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, #fbbf24, #f97316);
      color: #1a0a00;
      box-shadow: 0 4px 20px rgba(251,191,36,0.35);
    }
    .btn-primary:active { transform: scale(0.97); box-shadow: 0 2px 10px rgba(251,191,36,0.2); }

    .btn-secondary {
      background: var(--glass); color: var(--text);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(12px); margin-top: 10px;
    }
    .btn-secondary:active { transform: scale(0.97); }
    .btn:disabled { opacity: 0.3; cursor: not-allowed; }

    .validation-msg { font-size: 0.75rem; color: var(--red); text-align: center; margin-top: 10px; min-height: 18px; font-weight: 500; }

    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.12); border-radius: 2px; }

    /* === MODAL === */
    .modal-overlay {
      display: none; position: fixed; inset: 0;
      background: rgba(0,0,0,0.75); z-index: 999;
      align-items: center; justify-content: center;
      padding: 30px 24px; backdrop-filter: blur(8px);
    }
    .modal-overlay.open { display: flex; }

    .modal-box {
      background: linear-gradient(135deg, #13101f, #1a1330);
      border: 1.5px solid rgba(139,92,246,0.35);
      border-radius: 24px; padding: 30px 24px 24px;
      text-align: center; max-width: 340px; width: 100%;
      box-shadow: 0 0 50px rgba(139,92,246,0.2), 0 20px 60px rgba(0,0,0,0.5);
      animation: popIn 0.28s cubic-bezier(.4,0,.2,1);
    }

    @keyframes popIn {
      from { transform: scale(0.82) translateY(20px); opacity: 0; }
      to   { transform: scale(1) translateY(0); opacity: 1; }
    }

    .modal-emoji { font-size: 3.2rem; display: block; margin-bottom: 14px; }
    .modal-title { font-size: 1.15rem; font-weight: 800; color: var(--red); margin-bottom: 10px; letter-spacing: -0.3px; }
    .modal-text { font-size: 0.85rem; color: rgba(255,255,255,0.75); line-height: 1.6; margin-bottom: 22px; }
    .modal-btn {
      background: linear-gradient(135deg, var(--red), #f97316);
      color: #fff; border: none; border-radius: 14px;
      padding: 14px 30px; font-size: 0.95rem; font-weight: 700;
      cursor: pointer; width: 100%; font-family: 'Inter', 'Segoe UI', sans-serif;
      box-shadow: 0 4px 16px rgba(239,68,68,0.35);
    }
    .sex-info-btn {
      background: rgba(139,92,246,0.18); border: 1.5px solid rgba(139,92,246,0.4); cursor: pointer;
      font-size: 1rem; padding: 2px 7px; border-radius: 8px;
      color: #fff; line-height: 1; flex-shrink: 0;
      transition: background 0.15s, border-color 0.15s;
    }
    .sex-info-btn:hover { background: rgba(139,92,246,0.35); border-color: rgba(139,92,246,0.7); }
    .sex-info-table { width: 100%; border-collapse: collapse; margin-top: 14px; }
    .sex-info-table td { padding: 9px 10px; font-size: 0.88rem; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.07); }
    .sex-info-table td:first-child { color: rgba(255,255,255,0.55); width: 55%; }
    .sex-info-table td:last-child { font-weight: 700; color: #fff; }
    .sex-info-table tr:last-child td { border-bottom: none; }
    .sex-info-yes { color: #4ade80 !important; }
    .sex-info-no  { color: var(--red) !important; }

    /* === ITINERARIO === */
    .itin-toggle {
      display: flex; align-items: center; justify-content: center; gap: 8px;
      background: rgba(139,92,246,0.1);
      border: 1px solid rgba(139,92,246,0.25);
      border-radius: 12px; padding: 11px 14px;
      font-size: 0.82rem; font-weight: 700; cursor: pointer;
      margin-top: 12px; color: rgba(196,181,253,0.9); width: 100%;
      transition: all 0.2s; letter-spacing: -0.1px;
    }
    .itin-toggle:active { background: rgba(139,92,246,0.2); }

    /* === PANEL METE === */
    .mete-panel {
      display: none; position: fixed; inset: 0;
      background: #07090f; z-index: 998; overflow-y: auto; padding-bottom: 60px;
    }
    .mete-panel.open { display: block; animation: slideUp 0.3s cubic-bezier(.4,0,.2,1) both; }
    @keyframes slideUp {
      from { transform: translateY(40px); opacity: 0; }
      to   { transform: translateY(0); opacity: 1; }
    }

    .mete-panel-header {
      position: sticky; top: 0;
      background: rgba(7,9,15,0.9);
      backdrop-filter: blur(20px);
      padding: 18px 18px 14px;
      display: flex; align-items: center; justify-content: space-between;
      border-bottom: 1px solid var(--glass-border); z-index: 1;
    }
    .mete-panel-header h2 { font-size: 1.1rem; font-weight: 800; margin: 0; letter-spacing: -0.4px; }
    .mete-panel-close {
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.12); color: #fff; border-radius: 50%;
      width: 36px; height: 36px; font-size: 1rem; cursor: pointer;
      display: flex; align-items: center; justify-content: center; flex-shrink: 0;
      transition: background 0.2s;
    }
    .mete-panel-close:active { background: rgba(255,255,255,0.18); }
    .mete-card {
      margin: 14px 14px 0;
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 18px; padding: 18px;
      backdrop-filter: blur(12px);
    }
    .mete-card-title { font-size: 1.05rem; font-weight: 800; margin-bottom: 4px; letter-spacing: -0.3px; }
    .mete-card-days { font-size: 0.73rem; color: var(--muted); font-weight: 500; margin-bottom: 9px; }
    .mete-card-desc { font-size: 0.8rem; color: rgba(255,255,255,0.68); line-height: 1.55; white-space: pre-wrap; margin-bottom: 14px; }
    .mete-stats-title { font-size: 0.68rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.06em; color: var(--muted); margin-bottom: 8px; }
    .mete-stats { display: flex; flex-direction: column; gap: 7px; margin-bottom: 14px;
      background: rgba(0,0,0,0.25); border: 1px solid var(--glass-border); border-radius: 12px; padding: 12px 14px; }
    .mete-stat-row { display: flex; align-items: center; gap: 10px; }
    .mete-stat-label { font-size: 0.72rem; color: rgba(255,255,255,0.55); flex: 0 0 145px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .mete-stat-label span { margin-right: 4px; }
    .mete-stat-track { flex: 1; display: flex; gap: 4px; }
    .mete-stat-seg { flex: 1; height: 7px; border-radius: 4px; background: rgba(255,255,255,0.08); transition: background .2s; }
    .mete-stat-seg.on { background: var(--accent); }
    .mete-itin-toggle {
      display: flex; align-items: center; gap: 6px;
      background: rgba(139,92,246,0.1);
      border: 1px solid rgba(139,92,246,0.25);
      border-radius: 10px; padding: 10px 12px;
      font-size: 0.8rem; font-weight: 700; cursor: pointer;
      color: rgba(196,181,253,0.9); width: 100%;
    }
    .mete-itin-list { display: none; margin-top: 10px; padding: 0; list-style: none; }
    .mete-itin-list.open { display: block; }
    .mete-itin-list li {
      font-size: 0.78rem; color: rgba(255,255,255,0.72); line-height: 1.55;
      padding: 7px 0; border-bottom: 1px solid rgba(255,255,255,0.05);
      display: flex; gap: 8px;
    }
    .mete-itin-list li:last-child { border-bottom: none; }
    .mete-day-num { font-weight: 700; color: var(--purple); min-width: 58px; flex-shrink: 0; font-size: 0.74rem; }

    .itin-section {
      display: none; margin-top: 12px;
      background: rgba(139,92,246,0.05);
      border: 1px solid rgba(139,92,246,0.15);
      border-radius: 14px; overflow: hidden;
    }
    .itin-section.open { display: block; }

    .itin-day {
      padding: 11px 14px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      display: flex; gap: 10px; align-items: flex-start;
    }
    .itin-day:last-child { border-bottom: none; }

    .itin-num {
      background: rgba(139,92,246,0.18); border: 1px solid rgba(139,92,246,0.3);
      color: rgba(196,181,253,0.9); font-size: 0.63rem; font-weight: 800;
      min-width: 28px; height: 20px; border-radius: 6px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0; margin-top: 2px;
    }

    .itin-text { font-size: 0.78rem; line-height: 1.47; color: rgba(255,255,255,0.78); }

    /* ── NAME SCREEN ── */
    .name-label { display: block; font-size: 0.78rem; font-weight: 700; color: var(--muted); margin-bottom: 9px; text-align: left; }
    .name-input-wrap { width: 100%; }
    .name-input {
      width: 100%; box-sizing: border-box;
      background: rgba(255,255,255,0.06);
      border: 1.5px solid rgba(255,255,255,0.15);
      border-radius: 14px; padding: 15px 18px;
      font-size: 1.1rem; color: #fff; outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
      font-family: 'Inter', 'Segoe UI', sans-serif; font-weight: 600;
    }
    .name-input:focus {
      border-color: rgba(245,158,11,0.6);
      box-shadow: 0 0 0 3px rgba(245,158,11,0.1);
    }
    .name-input::placeholder { opacity: 0.3; }
    .or-divider { font-size: 0.73rem; color: var(--muted); margin: 16px 0 10px; text-align: center; font-weight: 500; }

    /* ── LEADERBOARD ── */
    .lb-section-title {
      font-size: 0.72rem; font-weight: 800; color: var(--muted);
      text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 14px;
    }
    .lb-rank-row {
      display: flex; align-items: center; gap: 12px;
      padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .lb-rank-row:last-child { border-bottom: none; }
    .lb-medal { font-size: 1.4rem; flex-shrink: 0; }
    .lb-rank-info { flex: 1; min-width: 0; }
    .lb-rank-name { font-size: 0.86rem; font-weight: 700; margin-bottom: 6px; }
    .lb-bar-wrap { height: 5px; background: rgba(255,255,255,0.08); border-radius: 99px; overflow: hidden; }
    .lb-bar-fill { height: 100%; border-radius: 99px; background: linear-gradient(90deg, var(--purple), #38bdf8); transition: width 0.6s ease; }
    .lb-count { font-size: 0.72rem; font-weight: 700; color: var(--muted); flex-shrink: 0; text-align: right; min-width: 42px; }
    .lb-user-row {
      display: flex; align-items: center; gap: 8px;
      padding: 9px 0; border-bottom: 1px solid rgba(255,255,255,0.04); font-size: 0.82rem;
    }
    .lb-user-row:last-child { border-bottom: none; }
    .lb-user-name { flex: 1; font-weight: 600; }
    .lb-user-dest { color: var(--muted); white-space: nowrap; font-size: 0.78rem; }
    .lb-user-date { font-size: 0.67rem; color: rgba(255,255,255,0.25); white-space: nowrap; }

    /* ── JOKE SCREEN ── */
    .joke-card {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 22px; padding: 26px 20px 22px;
      display: flex; flex-direction: column; align-items: center; gap: 6px;
      backdrop-filter: blur(16px);
    }
    .joke-dest-flag { line-height: 1; margin-bottom: 4px; }
    .joke-dest-name { font-size: 2.1rem; font-weight: 900; text-align: center; letter-spacing: -1px; margin-bottom: 16px; }
    .joke-img-wrap { width: 100%; border-radius: 16px; overflow: hidden; }
    .joke-img-wrap img { width: 100%; height: 240px; object-fit: cover; display: block; border-radius: 16px; }
    .joke-img-fallback {
      display: none; width: 100%; height: 200px;
      background: linear-gradient(135deg, #1a1330, #0e1220);
      border-radius: 16px; align-items: center; justify-content: center; font-size: 4rem;
    }
  </style>
</head>
<body>

<!-- PANEL METE -->
<div class="mete-panel" id="metePanel">
  <div class="mete-panel-header">
    <h2>&#x1F5FA;&#xFE0F; Tutte le mete</h2>
    <button class="mete-panel-close" onclick="closeMetePanel()">&#x2715;</button>
  </div>
  <div id="mete-panel-body"></div>
</div>

<!-- MODAL INFO SCOPABILITA' -->
<div class="modal-overlay" id="sexInfoModal">
  <div class="modal-box">
    <span class="modal-emoji">&#x1F50E;</span>
    <div class="modal-title" id="sexInfoTitle"></div>
    <table class="sex-info-table" id="sexInfoTable"></table>
    <button class="modal-btn" onclick="closeSexInfoModal()" style="margin-top:20px">Ok capito &#x1F44D;</button>
  </div>
</div>

<!-- MODAL SCOPATA -->
<div class="modal-overlay" id="sexModal">
  <div class="modal-box">
    <span class="modal-emoji">💀</span>
    <div class="modal-title">Dai su...</div>
    <div class="modal-text">Inutile che metti 5.<br>Ricordati chi siete.<br><br>Questo voto rimarrà, ma almeno ora lo sai.</div>
    <button class="modal-btn" onclick="closeModal()">Ok ok, ho capito 😔</button>
  </div>
</div>

<header>
  <h1>&#x2708;&#xFE0F; Scegli la tua vacanza</h1>
  <p>Trova la meta perfetta per te</p>
</header>

<div class="progress-wrap" id="progressWrap" style="display:none">
  <div class="progress-label">
    <span id="progressText"></span>
    <span id="progressCount"></span>
  </div>
  <div class="progress-track">
    <div class="progress-fill" id="progressFill" style="width:0%"></div>
  </div>
</div>

<!-- NOME -->
<div class="screen active" id="screen-name">
  <div class="welcome-box" style="text-align:center">
    <span class="big-emoji">&#x1F30D;</span>
    <h1 style="font-size:1.6rem;font-weight:900;margin:0 0 4px">Scegli la tua vacanza</h1>
    <p style="opacity:0.55;font-size:0.83rem;margin:0 0 10px">Il quiz delle scelte difficili</p>
    <p style="opacity:0.4;font-size:0.72rem;margin:0 0 22px;line-height:1.5">&#x1F4C5; Stime per la <strong>seconda met&agrave; di agosto</strong><br>&#x1F697; Prezzi auto calcolati su <strong>3 persone per auto</strong></p>
    <div class="name-input-wrap">
      <label class="name-label">Il tuo nome</label>
      <input class="name-input" id="nameInput" type="text" placeholder="Es. Marco" autocomplete="off" maxlength="30"
             onkeydown="if(event.key==='Enter') startWithName()">
    </div>
    <button class="btn btn-primary" onclick="startWithName()" style="margin-top:18px">Inizia &#x1F680;</button>
    <div class="or-divider">oppure</div>
    <button class="btn btn-secondary" onclick="openMetePanel()" style="margin-bottom:10px">&#x1F5FA;&#xFE0F; Vedi le mete</button>
    <button class="btn btn-secondary" onclick="openLeaderboard()">&#x1F4CA; Vedi risultati degli altri</button>
  </div>
</div>

<!-- WELCOME -->
<div class="screen" id="screen-welcome">
  <div class="welcome-box">
    <span class="big-emoji">&#x1F30D;</span>
    <h2>Come funziona?</h2>
    <div class="how-it-works">
      <div class="step-row">
        <div class="step-num">1</div>
        <div>Ti viene mostrata ogni meta con una descrizione. Per ognuna valuti <strong>6 parametri</strong> da 1 a 5.</div>
      </div>
      <div class="step-row">
        <div class="step-num">2</div>
        <div>Scegli <strong>quanto conta</strong> ogni parametro per te (valori unici da 1 a 5).</div>
      </div>
      <div class="step-row">
        <div class="step-num">3</div>
        <div>Ottieni la <strong>classifica personalizzata</strong> basata sui tuoi voti e pesi.</div>
      </div>
    </div>
    <p>Ci sono <strong>8 mete</strong> da valutare.</p>
    <div style="margin-top:18px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:13px 14px;font-size:0.75rem;opacity:0.6;line-height:1.5;font-style:italic;">
      ⚠️ Ogni dato qua dentro è realistico. Soltanto che non avevo voglia di impegnarmi troppo, quindi ha fatto tutto ChatGPT.
    </div>
  </div>
  <button class="btn btn-secondary" onclick="openMetePanel()" style="margin-bottom:12px">&#x1F5FA;&#xFE0F; Vedi le mete</button>
  <button class="btn btn-primary" onclick="startDestinations()">Inizia &#x1F680;</button>
</div>

<!-- DEST -->
<div class="screen" id="screen-dest">
  <div class="dest-header" id="destHeader"></div>
  <p class="screen-subtitle">Valuta questa meta da 1 a 5 su ogni parametro</p>
  <div id="dest-params"></div>
  <p class="validation-msg" id="dest-msg"></p>
  <button class="btn btn-primary" id="btn-next-dest" onclick="nextDest()">Avanti &#x2192;</button>
  <button class="btn btn-secondary" id="btn-prev-dest" onclick="prevDest()">&#x2190; Indietro</button>
</div>

<!-- PESI -->
<div class="screen" id="screen-weights">
  <p class="screen-title">Quanto conta ogni parametro?</p>
  <div class="weight-info">
    Assegna un'importanza da <strong>1 a 5</strong> a ciascun parametro.<br>
    &#x26A0;&#xFE0F; Ogni numero pu&#xF2; essere usato <strong>una sola volta</strong>.
  </div>
  <div id="weights-container"></div>
  <p class="validation-msg" id="weights-msg"></p>
  <button class="btn btn-primary" onclick="calcResults()">Calcola &#x1F3AF;</button>
  <button class="btn btn-secondary" onclick="backToLastDest()">&#x2190; Indietro</button>
</div>

<!-- SCHERZO -->
<div class="screen" id="screen-joke">
  <p class="screen-title">&#x1F4CD; In base alle tue scelte dovresti andare a...</p>
  <div class="joke-card">
    <div class="joke-dest-flag" id="jokeFlag"></div>
    <div class="joke-dest-name" id="jokeName"></div>
    <div class="joke-img-wrap">
      <img id="jokeImg" src="" alt="" onerror="document.getElementById('jokeImgFallback').style.display='flex';this.style.display='none';">
      <div class="joke-img-fallback" id="jokeImgFallback"><span id="jokeFallbackEmoji"></span></div>
    </div>
  </div>
  <button class="btn btn-primary" onclick="showRealResults()" style="margin-top:28px">&#x1F605; Sto scherzando... scopri dove dovresti andare davvero &#x2192;</button>
</div>

<!-- RISULTATI -->
<div class="screen" id="screen-results">
  <p class="screen-title">&#x1F3C6; Le tue mete ideali</p>
  <p style="font-size:0.77rem;opacity:0.5;margin-bottom:18px">Classifica basata sui tuoi voti e pesi</p>
  <div id="results-container"></div>
  <button class="btn btn-primary" id="btnSalva" onclick="saveAndShowLeaderboard()">&#x1F4BE; Salva e vedi classifica</button>
  <button class="btn btn-secondary" onclick="resetAll()">&#x1F504; Ricomincia</button>
</div>

<!-- CLASSIFICA -->
<div class="screen" id="screen-leaderboard">
  <p class="screen-title">&#x1F4CA; Classifica del gruppo</p>
  <div id="leaderboard-container"></div>
  <button class="btn btn-primary" onclick="showScreen('name')" style="margin-top:18px">&#x1F504; Torna all'inizio</button>
</div>

<script>
// ─────────────────────────────────────────────────────────────────
// CONFIGURA QUI il database (JSONBin.io - gratuito)
// 1. Registrati su https://jsonbin.io
// 2. Dashboard → API Keys → copia la Master Key
// 3. Dashboard → Bins → New Bin → incolla {"results":[]} → crea → copia l'ID
// ─────────────────────────────────────────────────────────────────
const JB_BIN_ID = '699ca76cd0ea881f40d2b439';
const JB_KEY    = '$2a$10$ooqx9TmkgOSYGKJ7J/GDruT5gWEuBO1r/.VWzRHQbJXoNuil/Lq0q';
const JB_API    = 'https://api.jsonbin.io/v3/b/' + JB_BIN_ID;
// ─────────────────────────────────────────────────────────────────

const DEST_CODES = {
  'USA \u2013 Route 66':            'us',
  'USA \u2013 Grandi Parchi':       'us',
  'USA \u2013 West Coast & Parchi': 'us',
  'Mykonos':                        'gr',
  'Mykonos + Pag':                   'hr',
  'Canada':                         'ca',
  'Canada + USA Est':               'ca',
  'Argentina':                      'ar',
  'Thailandia':                     'th',
  'Per\u00f9':                       'pe',
};
const JOKE_CODES = { 'Catanzaro Lido': 'it', 'Tel Aviv': 'il', 'Palestina': 'ps', 'Nuova Delhi': 'in' };

function flagImg(code, h) {
  if (!code) return '';
  return '<img src="https://flagcdn.com/w80/' + code + '.png" height="' + (h || 24) + '" style="border-radius:3px;vertical-align:middle;display:inline-block" alt="' + code.toUpperCase() + '">';
}
function destFlagImg(name, h) { return flagImg(DEST_CODES[name] || '', h); }

const FIGA_LABELS = ['', 'SI ✅', 'NORMALE 😐', 'NO ❌', 'SONO NERE 🌍', 'SONO TRANS 🏳️‍⚧️'];

const DEST_SEX_INFO = {
  'USA \u2013 Route 66':            { figa: 2, darebbe: true  },
  'USA \u2013 Grandi Parchi':       { figa: 3, darebbe: false },
  'USA \u2013 West Coast & Parchi': { figa: 1, darebbe: true  },
  'Mykonos':                        { figa: 1, darebbe: true  },
  'Mykonos + Pag':                   { figa: 1, darebbe: true  },
  'Canada':                         { figa: 2, darebbe: false },
  'Canada + USA Est':               { figa: 2, darebbe: true  },
  'Argentina':                      { figa: 1, darebbe: true  },
  'Thailandia':                     { figa: 5, darebbe: true  },
  'Per\u00f9':                       { figa: 2, darebbe: false },
};

const DEST_STATS = {
  'USA \u2013 Route 66':            { sex:3, exp:5, eco:3, road:5, cool:5 },
  'USA \u2013 Grandi Parchi':       { sex:2, exp:5, eco:2, road:5, cool:5 },
  'USA \u2013 West Coast & Parchi': { sex:3, exp:4, eco:2, road:4, cool:4 },
  'Mykonos':                        { sex:5, exp:2, eco:1, road:1, cool:4 },
  'Mykonos + Pag':                   { sex:5, exp:2, eco:1, road:1, cool:5 },
  'Canada':                         { sex:2, exp:4, eco:3, road:4, cool:4 },
  'Canada + USA Est':               { sex:3, exp:4, eco:2, road:4, cool:4 },
  'Argentina':                      { sex:4, exp:5, eco:3, road:4, cool:5 },
  'Thailandia':                     { sex:5, exp:4, eco:4, road:2, cool:4 },
  'Per\u00f9':                       { sex:2, exp:5, eco:3, road:3, cool:5 },
};

function renderStatBar(val) {
  var s = '';
  for (var i = 1; i <= 5; i++) s += '<div class="mete-stat-seg' + (i <= val ? ' on' : '') + '"></div>';
  return '<div class="mete-stat-track">' + s + '</div>';
}

const PARAMS = [
  { id: 'sex',  emoji: '\u{1F351}', label: 'Sex Index', hint: '1=incellandia \u00b7 5=paradiso' },
  { id: 'exp',  emoji: '\u{1F30D}', label: 'Esperienze',               hint: '1=poche \u00b7 5=tantissime' },
  { id: 'eco',  emoji: '\u{1F4B8}', label: 'Economicit\u00e0',         hint: '1=costosissima \u00b7 5=super economica' },
  { id: 'road', emoji: '\u{1F6FB}', label: 'On the road',              hint: '1=stanziale \u00b7 5=piena libert\u00e0' },
  { id: 'cool', emoji: '\u{1F60E}', label: 'Quanto \u00e8 fica',       hint: '1=per niente \u00b7 5=leggendaria' },
  { id: 'want', emoji: '\u{1F929}', label: 'Quanto ci vuoi andare',    hint: '1=per niente \u00b7 5=voglio andarci ora', alwaysMax: true },
];

const DESTINATIONS = [
  { name: 'USA \u2013 Route 66',        flag: '\u{1F1FA}\u{1F1F8}', days: 15,
    desc: 'Da Chicago a Santa Monica lungo la Mother Road: diner retr\u00f2, deserti rossi, insegne al neon e 4.000 km di asfalto leggendario. Lungo il percorso: il Gateway Arch di St. Louis, i ranch texani di Amarillo, Santa Fe, il Grand Canyon, Monument Valley, Horseshoe Bend e Las Vegas prima del gran finale sul Pier di Santa Monica. L\u2019America on the road fatta per davvero.\n\n\u{1F5FA}\uFE0F Distanza totale: ~4.000 km (Chicago \u2192 Santa Monica)\n\n\u{1F4B0} Costo stimato per persona (gruppo di 6, seconda met\u00e0 agosto, 3pp/auto):\n\u2708\uFE0F Volo A/R MXP\u2192ORD + LAX\u2192MXP (open-jaw): ~1.100 \u20ac\n\uD83D\uDE97 2 auto 15gg + carburante (~4.200 km, 3pp/auto): ~700 \u20ac\n\uD83C\uDFDE\uFE0F America the Beautiful Pass 2026 ($250/auto \u00d7 2): ~80 \u20ac\n\uD83C\uDFE8 Alloggio 14 notti (3 camere, motel/hotel): ~550 \u20ac\n\uD83C\uDF54 Vitto 15 giorni: ~400 \u20ac\n\uD83D\uDEE1\uFE0F Assicurazione viaggio completa (Allianz/Unipol, 6pp): ~130 \u20ac\n\uD83D\uDCCA Totale stimato: ~2.960 \u20ac a persona.',
    itinerary: [
      'Volo MXP\u2192ORD (Chicago), arrivo, Magnificent Mile, Navy Pier, cena con deep dish pizza.',
      'Chicago \u2013 The Bean, Willis Tower Skydeck, Museum Campus, aperitivo sul lago Michigan.',
      'Chicago\u2192Springfield (Route 66 km 0!)\u2192St. Louis (~480 km) \u2013 Gateway Arch, tramonto sul Mississippi.',
      'St. Louis\u2192Oklahoma City (~800 km, si va a turni di guida) \u2013 praterie che non finiscono mai.',
      'Oklahoma City\u2192Amarillo (~360 km) \u2013 ranch texani, Cadillac Ranch, Midpoint Caf\u00e9.',
      'Amarillo\u2192Santa Fe (~340 km) \u2013 New Mexico, adobe, cibo tex-mex, turquoise trail.',
      'Santa Fe\u2192Albuquerque\u2192Gallup \u2013 pueblos, Petroglyph National Monument.',
      'Gallup\u2192Petrified Forest NP\u2192Flagstaff \u2013 deserto pietrificato, cieli enormi.',
      'Flagstaff\u2192Grand Canyon South Rim (~80 km) \u2013 arrivo, tramonto sul canyon.',
      'Grand Canyon \u2013 giornata intera: Bright Angel Trail, viewpoint East Rim, Desert View.',
      'Grand Canyon\u2192Page \u2013 Horseshoe Bend al tramonto + Antelope Canyon (tour guidato).',
      'Page\u2192Monument Valley\u2192Kayenta \u2013 le mesas rosse pi\u00f9 fotografate al mondo, notte nel deserto.',
      'Monument Valley\u2192Hoover Dam\u2192Las Vegas (~430 km) \u2013 arrivo sulla Strip.',
      'Las Vegas \u2013 giornata libera: casino, spettacoli, piscina, Fremont Street.',
      'Las Vegas\u2192Santa Monica lungo la Route 66 finale (~280 km) \u2013 il cartello di fine strada sul molo. Poi LAX e volo di rientro.',
    ]
  },
  { name: 'USA \u2013 Grandi Parchi',       flag: '\u{1F1FA}\u{1F1F8}', days: 15,
    desc: 'Las Vegas come base di partenza e punto di ritorno. In mezzo: Zion, Bryce Canyon, Capitol Reef, Canyonlands, Arches, Moab, Monument Valley, Horseshoe Bend e il Grand Canyon. Il meglio dell\u2019altopiano del Colorado in un unico loop da 15 giorni. Niente coste, niente citt\u00e0. Solo canyon, dune e cieli stellati.\n\n\u{1F5FA}\uFE0F Distanza totale: ~2.800 km (loop da Las Vegas)\n\n\u{1F4B0} Costo stimato per persona (gruppo di 6, seconda met\u00e0 agosto, 3pp/auto):\n\u2708\uFE0F Volo A/R MXP\u2192LAS (scalo): ~1.100 \u20ac\n\uD83D\uDE97 2 auto 15gg + carburante (~2.800 km, 3pp/auto): ~700 \u20ac\n\uD83C\uDFDE\uFE0F America the Beautiful Pass 2026 ($250/auto \u00d7 2): ~80 \u20ac\n\uD83C\uDFE8 Alloggio 14 notti (3 camere, mix lodge/motel): ~550 \u20ac\n\uD83C\uDF54 Vitto 15 giorni: ~400 \u20ac\n\uD83D\uDEE1\uFE0F Assicurazione viaggio completa (Allianz/Unipol, 6pp): ~130 \u20ac\n\uD83D\uDCCA Totale stimato: ~2.960 \u20ac a persona.',
    itinerary: [
      'Volo MXP\u2192LAS (scalo), arrivo Las Vegas, check-in Strip, prima serata sul lungofiume di neon.',
      'Las Vegas \u2013 giornata libera: casin\u00f2, piscina, Fremont Street Experience.',
      'Las Vegas\u2192Zion National Park (~2,5h) \u2013 Angels Landing, The Narrows, canyon vermiglio.',
      'Zion\u2192Bryce Canyon (~1,5h) \u2013 altopiano a 2.800 m, hoodoos arancioni, alba spettacolare.',
      'Bryce Canyon\u2192Capitol Reef (~2h) \u2013 Waterpocket Fold, frutti dagli alberi del parco, silenzio puro.',
      'Capitol Reef\u2192Canyonlands National Park (Island in the Sky) \u2013 vista su due fiumi dal bordo del precipizio.',
      'Canyonlands\u2192Arches National Park \u2013 Delicate Arch al tramonto, Landscape Arch, Windows.',
      'Moab \u2013 giornata di attivit\u00e0: canyoning/mountain bike sul Colorado/rafting (a scelta).',
      'Moab\u2192Monument Valley (~2,5h) \u2013 le mesas rosse, notte nel deserto vero con stelle senza fine.',
      'Monument Valley\u2192Page (~1,5h) \u2013 Horseshoe Bend mattino presto, Antelope Canyon guidato.',
      'Page\u2192Grand Canyon North Rim \u2013 lato meno frequentato, 300 m pi\u00f9 in quota del South Rim.',
      'Grand Canyon North Rim\u2192South Rim (percorso attraverso il deserto) \u2013 tramonto dal Desert View.',
      'Grand Canyon\u2192Sedona (~2h) \u2013 red rock vortex energy, sentieri panoramici, arte locale.',
      'Sedona\u2192Hoover Dam\u2192Las Vegas (~4h) \u2013 ultima notte sulla Strip.',
      'Las Vegas\u2192aeroporto, volo di rientro per l\u2019Italia.',
    ]
  },
  { name: 'USA \u2013 West Coast & Parchi', flag: '\u{1F1FA}\u{1F1F8}', days: 14,
    desc: 'Los Angeles, San Diego, Joshua Tree, Death Valley, Yosemite, San Francisco e la Highway 1 lungo Big Sur. Il meglio della California in 14 giorni: spiagge, deserti, sequoie e Golden Gate. Un loop che parte e finisce a LAX, tutto su strada, tutto diverso ogni giorno.\n\n\u{1F5FA}\uFE0F Distanza totale: ~3.200 km (loop da Los Angeles)\n\n\u{1F4B0} Costo stimato per persona (gruppo di 6, seconda met\u00e0 agosto, 3pp/auto):\n\u2708\uFE0F Volo A/R MXP\u2192LAX: ~1.100 \u20ac\n\uD83D\uDE97 2 auto 14gg + carburante (~3.200 km, 3pp/auto): ~700 \u20ac\n\uD83C\uDFDE\uFE0F America the Beautiful Pass 2026 ($250/auto \u00d7 2): ~80 \u20ac\n\uD83C\uDFE8 Alloggio 13 notti (3 camere, hotel/motel): ~550 \u20ac\n\uD83C\uDF54 Vitto 14 giorni: ~400 \u20ac\n\uD83D\uDEE1\uFE0F Assicurazione viaggio completa (Allianz/Unipol, 6pp): ~130 \u20ac\n\uD83D\uDCCA Totale stimato: ~2.960 \u20ac a persona.',
    itinerary: [
      'Volo MXP\u2192LAX, ritiro auto, check-in, tramonto a Santa Monica e Venice Beach.',
      'Los Angeles \u2013 Bel-Air, Beverly Hills, Hollywood Boulevard, Griffith Observatory.',
      'LA\u2192San Diego (~200 km) \u2013 Balboa Park, Old Town, Gaslamp Quarter, cena sulla baia.',
      'San Diego\u2192Joshua Tree National Park \u2013 foresta di cactus, tramonto alieno, notte a Twentynine Palms.',
      'Joshua Tree\u2192Palm Springs\u2192Death Valley (~3h) \u2013 Badwater Basin (\u221286 m), Zabriskie Point.',
      'Death Valley\u2192Lone Pine\u2192Mammoth Lakes \u2013 Eastern Sierra Nevada, i laghi alpini californiani.',
      'Mammoth Lakes\u2192Yosemite (Tioga Pass) \u2013 Half Dome vista, Yosemite Valley, cervi al tramonto.',
      'Yosemite \u2013 giornata intera: Glacier Point, Nevada Falls, Mirror Lake.',
      'Yosemite\u2192San Francisco (~3,5h) \u2013 Golden Gate Bridge, Fisherman\u2019s Wharf, Haight-Ashbury.',
      'San Francisco \u2013 Alcatraz (prenotare prima!), Castro, Mission District, cena al Ghirardelli Square.',
      'San Francisco\u2192Big Sur (~2,5h) \u2013 Highway 1 costiera mozzafiato, Bixby Bridge, McWay Falls, foche.',
      'Big Sur\u2192Santa Barbara (~3h) \u2013 spiagge bianche, architettura spagnola, aperitivo sul porto.',
      'Santa Barbara\u2192Malibu\u2192Los Angeles (~1,5h) \u2013 ultima spiaggia californiana, tramonto a Malibu.',
      'Los Angeles \u2013 mattina libera, poi LAX e volo di rientro per l\u2019Italia.',
    ]
  },
  { name: 'Mykonos',                    flag: '\u{1F1EC}\u{1F1F7}', days: 5,
    desc: 'Ah i paesaggi, i tramonti, l\'architettura cicladica... ma dai. Ma la figa? Non scopate ugualmente tanto.\n\n\u{1F5FA}\uFE0F Spostamenti interni (taxi/quad): ~100 km\n\n\u{1F4B0} Costo stimato per persona (gruppo di 4, luglio\u2013agosto):\n\u2708\uFE0F Volo A/R (low cost da Milano): ~220 \u20ac\n\uD83C\uDFE8 Alloggio 5 notti (2 camere, alta stagione): ~600 \u20ac\n\uD83C\uDF7D\uFE0F Cibo + beach club + cocktail 5 giorni: ~500 \u20ac\n\uD83D\uDEF5 Taxi e quad: ~150 \u20ac\n\uD83D\uDCCA Totale stimato: ~1.470 \u20ac a persona.',
    itinerary: [
      'Arrivo a Mykonos – check-in, spiaggia a Paradise Beach, serata al Tropicana Beach Club.',
      'Mykonos – mattina relax, pomeriggio e sera al Tropicana.',
      'Mykonos – colazione tardi, Tropicana tutto il pomeriggio e party la sera.',
      'Mykonos – giornata intera al Tropicana, mare + aperitivi + serata.',
      'Mykonos – ultime ore al Tropicana, poi rientro.',
    ]
  },
  { name: 'Mykonos + Pag',             flag: '\u{1F1EC}\u{1F1F7}\u{1F1ED}\u{1F1F7}', days: 10,
    desc: 'Cinque giorni a Mykonos \u2013 paesaggi cicladici, Tropicana Beach Club, tramonti e cocktail \u2013 poi volo in Croazia e cinque serate di fila a Zr\u0107e Beach, la Ibiza dei Balcani. Base: Novalja, sull\u2019isola di Pag. Diurno: spiaggia e sonno. Serale: Papaya, Aquarius, Kalypso e Noa non-stop fino all\u2019alba.\n\n\u{1F5FA}\uFE0F Trasferimento: volo Mykonos\u2192Atene\u2192Spalato (o Zara) + bus Novalja (~mezza giornata)\n\n\u{1F4B0} Costo stimato per persona (gruppo di 4, luglio\u2013agosto):\n\u2708\uFE0F Volo A/R MXP\u2192JMK + SPU\u2192MXP (open-jaw, low cost): ~280 \u20ac\n\u2708\uFE0F Volo interno Mykonos\u2192Atene\u2192Spalato/Zara (Sky Express + Ryanair/easyJet): ~150 \u20ac\n\uD83C\uDFE8 Alloggio 5n Mykonos (2 camere, alta stagione): ~600 \u20ac\n\uD83C\uDFE0 Alloggio 5n Novalja (2 camere, appartamento): ~250 \u20ac\n\uD83C\uDF7D\uFE0F Cibo + beach club + cocktail Mykonos 5gg: ~500 \u20ac\n\uD83C\uDF7B Cibo + aperitivi + club Pag 5gg: ~250 \u20ac\n\uD83D\uDEF5 Taxi/quad Mykonos + transfer Pag: ~150 \u20ac\n\uD83D\uDCCA Totale stimato: ~2.180 \u20ac a persona.',
    itinerary: [
      'Mykonos \u2013 arrivo, check-in, spiaggia a Paradise Beach, serata al Tropicana Beach Club.',
      'Mykonos \u2013 mattina relax, pomeriggio e sera al Tropicana.',
      'Mykonos \u2013 colazione tardi, Tropicana tutto il pomeriggio e party la sera.',
      'Mykonos \u2013 giornata intera al Tropicana, mare + aperitivi + serata.',
      'Mykonos \u2192 Atene (volo Sky Express ~40 min) \u2192 Spalato o Zara (volo Ryanair/easyJet ~1h30) + bus Novalja (~40 min): check-in, prima serata al Papaya Club.',
      'Pag / Novalja \u2013 primo giorno sull\u2019isola, spiaggia di Zr\u0107e di giorno, serata al Papaya Club: house e DJ internazionali dalle 23, open-air fino all\u2019alba.',
      'Pag \u2013 relax in spiaggia di giorno. Sera all\u2019Aquarius: after-beach fino alle 20, poi main party dalle 22 con foam e techno non-stop.',
      'Pag \u2013 colazione tarda. Party serale tra Kalypso (vocal house) e Noa Beach Club, open dalle 22 con vista mare e guest DJ.',
      'Pag \u2013 giornata libera. Rotazione club Zr\u0107e (Papaya/Aquarius) dalle 23: festival vibe, balli fino al sunrise.',
      'Pag \u2013 ultime ore di party (Noa o Aquarius dalle 22). Rientro mattutino verso Split e volo per casa.',
    ]
  },
  { name: 'Canada',                     flag: '\u{1F1E8}\u{1F1E6}', days: 12,
    desc: 'Vancouver, la Sea to Sky Highway verso Whistler, il trekking ai tre laghi di Joffre, l\'Icefields Parkway con i ghiacciai, Jasper, Moraine Lake all\'alba, Banff e i dinosauri di Drumheller. 12 giorni nell\'ovest canadese tra foreste pluviali, laghi turchesi e badlands.\n\n\u{1F5FA}\uFE0F Distanza su strada: ~1.800 km\n\n\u{1F4B0} Costo stimato per persona (gruppo di 6, estate):\n\u2708\uFE0F Volo A/R MXP\u2192YVR + YYC\u2192MXP (one-way): ~950 \u20ac\n\uD83D\uDE97 2 auto nol. 12gg (young driver fee CAD 30/gg + CDW): ~365 \u20ac\n\u26FD Carburante 2 auto (~1.800 km): ~80 \u20ac\n\uD83C\uDFDE\uFE0F Canada Discovery Pass (CAD 150/auto \u00d7 2): ~35 \u20ac\n\uD83C\uDFE8 Alloggio 11 notti (3 camere, mix hotel/lodge): ~500 \u20ac\n\uD83C\uDF54 Vitto 12 giorni (Canada \u00e8 caro): ~540 \u20ac\n\uD83D\uDEE1\uFE0F Assicurazione viaggio completa (Allianz/Unipol, 6pp): ~130 \u20ac\n\uD83D\uDCCA Totale stimato: ~2.600\u20132.800 \u20ac a persona.',
    itinerary: [
      'Arrivo a Vancouver – Downtown, Canada Place, seawall, cena in citt\u00e0.',
      'Vancouver – Stanley Park, quartieri caratteristici, lungomare.',
      'Vancouver \u2192 Whistler \u2192 Pemberton – Sea to Sky Highway, paesaggi mozzafiato, pernottamento a Pemberton.',
      'Joffre Lakes – trekking ai 3 laghi turchesi, seconda notte a Pemberton.',
      'Pemberton \u2192 Clearwater – strada interna, fattoria sul fiume, paesaggi rurali.',
      'Clearwater \u2192 Jasper – canyon, cascate e progressivo ingresso nelle Rockies.',
      'Jasper – Maligne Lake e Valley of Five Lakes, possibile avvistamento di fauna.',
      'Jasper \u2192 Lake Louise – Icefields Parkway, ghiacciai, panorami da cartolina.',
      'Moraine Lake e Consolation Lake – alba sul lago, trekking tra i larici.',
      'Lake Louise \u2192 Emerald Lake – sentieri panoramici, canoa su acque smeraldo, pernottamento zona Yoho/Banff.',
      'Banff e Vermilion Lakes – ultima mattina nelle Rockies, tramonto tra i laghi.',
      'Rockies \u2192 Drumheller Badlands \u2192 Calgary – dinosauri fossilizzati, hoodoos nel deserto, volo di rientro.',
    ]
  },
  { name: 'Argentina',                  flag: '\u{1F1E6}\u{1F1F7}', days: 15,
    desc: 'Buenos Aires con tango e bistecche, poi un volo interno in Patagonia: il Perito Moreno che crolla in mare, El Chalten ai piedi del Fitz Roy e le Torres del Paine in Cile. 15 giorni tra cultura sudamericana esplosiva, ghiacciai immensi e trekking d\u2019alta quota.\n\n\u{1F5FA}\uFE0F Distanza su strada: ~2.500 km\n\n\u{1F4B0} Costo stimato per persona (gruppo di 6):\n\u2708\uFE0F Volo A/R MXP\u2192EZE (scalo): ~1.100 \u20ac\n\u2708\uFE0F Volo interno EZE\u2192FTE (El Calafate): ~230 \u20ac\n\uD83D\uDE8C Transfer e remise in Patagonia (\u00f76): ~100 \u20ac\n\uD83C\uDFE8 Alloggio 14 notti (mix hostel/hotel/lodge): ~810 \u20ac\n\uD83E\uDD69 Vitto 15gg (bistecche + trattorie): ~520 \u20ac\n\u26F0\uFE0F Ingressi parchi (Torres del Paine + Los Glaciares): ~80 \u20ac\n\uD83D\uDEE1\uFE0F Assicurazione viaggio completa (Allianz/Unipol, 6pp): ~70 \u20ac\n\uD83D\uDCCA Totale stimato: ~2.910\u20133.110 \u20ac a persona.',
    itinerary: [
      'Arrivo a Buenos Aires – check-in, Caminito e La Boca, cena con tango show.',
      'Buenos Aires – Palermo, San Telmo, mercato della Recoleta.',
      'Buenos Aires – giornata libera, Tigre Delta opzionale.',
      'Buenos Aires \u2192 El Calafate – volo interno, arrivo in Patagonia.',
      'El Calafate – Glaciar Perito Moreno (trekking sul ghiacciaio opzionale).',
      'El Calafate – altri viewpoint del ghiacciaio, lago Argentino.',
      'El Calafate \u2192 El Chalten – capitale del trekking, prime camminate.',
      'El Chalten – Laguna de los Tres (base Fitz Roy), vista mozzafiato.',
      'El Chalten – Laguna Torre o giornata libera.',
      'El Chalten \u2192 Puerto Natales (Chile) – confine, Torres del Paine.',
      'Torres del Paine – Mirador Las Torres, trek nel parco.',
      'Torres del Paine – Valle del Franc\u00e9s o lago Grey.',
      'Puerto Natales \u2192 Punta Arenas \u2192 Buenos Aires – volo di rientro.',
      'Buenos Aires – ultimo giorno, shopping e cena in steakhouse.',
      'Rientro in Italia.',
    ]
  },
  { name: 'Toscana \u2013 Capo Nord',   flag: '\u{1F1EE}\u{1F1F9}\u{1F6D1}', days: 15,
    desc: 'Si parte dalla Toscana e si sale in auto attraverso Belgio, Amsterdam, Amburgo, Copenaghen, Oslo, il Circolo Polare Artico, le Lofoten, Troms\u00f8 e si arriva a Capo Nord. Il punto pi\u00f9 a nord d\'Europa. Poi si torna pure. 7 paesi, 15 giorni, zero aerei. Follia pura.\n\n\u{1F5FA}\uFE0F Distanza totale: ~7.500\u20138.000 km\n\n\u{1F4B0} Costo stimato per persona (gruppo di 6, 2 auto proprie + estate):\n\uD83D\uDE97 Carburante 2 auto (~8.000 km, media 1,75/L): ~380 \u20ac\n\u26F4\uFE0F Traghetti (Lofoten + breve Bognes): ~70 \u20ac\n\uD83D\uDEE3\uFE0F Pedaggi e vignette (7 paesi): ~40 \u20ac\n\uD83C\uDFE8 Alloggio 15 notti (3 camere, mix camping/hostel/hotel): ~870 \u20ac\n\uD83C\uDF7D\uFE0F Vitto 15gg (Norvegia e Scandinavia sono carissime): ~820 \u20ac\n\u26A0\uFE0F Con auto a noleggio (young driver surcharge): +~500 \u20ac/persona\n\uD83D\uDCCA Totale stimato (propria auto): ~2.180\u20132.380 \u20ac a persona.',
    itinerary: [
      'Toscana \u2192 Lione (~560 km) \u2013 tunnel del Fr\u00e9jus, attraversata alpina, prima notte in Francia.',
      'Lione \u2192 Strasburgo (~490 km) \u2013 autostrada A6/A36, citt\u00e0 alsaziana, cattedrale gotica.',
      'Strasburgo \u2192 Colonia (~450 km) \u2013 Germania, Dom di Colonia, cena con K\u00f6lsch.',
      'Colonia \u2192 Amburgo (~450 km) \u2013 porto, Speicherstadt, Reeperbahn by night.',
      'Amburgo \u2192 Copenaghen (~310 km) \u2013 Nyhavn, Str\u00f8get, prima serata scandinava.',
      'Copenaghen \u2192 Oslo (~600 km) \u2013 ponte di \u00d8resund, Malm\u00f6, G\u00f6teborg, Norvegia.',
      'Oslo \u2013 sosta in citt\u00e0: Vigeland Park, Opera, Aker Brygge, fiordo. 0 km.',
      'Oslo \u2192 Trondheim (~550 km) \u2013 E6 verso nord, foreste, vallate sempre pi\u00f9 selvagge.',
      'Trondheim \u2192 Mo i Rana / Circolo Polare Artico (~460 km) \u2013 si attraversa il 66\u00b033\'N. Cartello, foto, si festeggia.',
      'Mo i Rana \u2192 Bod\u00f8 \u2192 traghetto \u2192 Lofoten (~250 km + 4h ferry) \u2013 villaggi rossi, montagne nell\'oceano.',
      'Lofoten \u2013 giornata intera sull\'arcipelago (~100 km) \u2013 Henningsv\u00e6r, Reine, \u00c5. Il punto pi\u00f9 bello del viaggio.',
      'Lofoten \u2192 Troms\u00f8 (~420 km, traghetto breve Fiskeb\u00f8l\u2013Melbu incluso) \u2013 la capitale dell\'Artico.',
      'Troms\u00f8 \u2192 Alta \u2192 Capo Nord (~520 km) \u2013 si arriva. Scogliera a 71\u00b010\'N. Oceano Artico. Foto. Si piange.',
      'Capo Nord \u2192 Alta (~220 km) + volo Alta\u2192Oslo\u2192Monaco di Baviera \u2013 fine della follia. Notte in Baviera.',
      'Monaco di Baviera \u2192 Innsbruck \u2192 Brennero \u2192 Toscana (~580 km) \u2013 a casa. Pasta. Si piange di nuovo.',
    ]
  },
  { name: 'Canada + USA Est',           flag: '\u{1F1E8}\u{1F1E6}\u{1F1FA}\u{1F1F8}', days: 13,
    desc: 'Toronto e le Cascate del Niagara, poi Ottawa, Montr\u00e9al e Qu\u00e9bec City nella parte francofona, e infine la East Coast americana: Boston, il Cape Cod, le comunit\u00e0 Amish, Washington DC, Philadelphia e New York. 13 giorni, 2 nazioni, storia coloniale, grattacieli e una fetta d\u2019America che la gente non si aspetta.\n\n\u{1F5FA}\uFE0F Distanza su strada: ~2.400 km\n\n\u{1F4B0} Costo stimato per persona (gruppo di 6, estate):\n\u2708\uFE0F Volo A/R MXP\u2192YYZ + JFK\u2192MXP (open-jaw): ~680 \u20ac\n\uD83D\uDE97 2 auto nol. 13gg (young driver fee + CDW): ~450 \u20ac\n\u26FD Carburante 2 auto (~2.400 km): ~130 \u20ac\n\uD83C\uDFE8 Alloggio 12 notti (3 camere, mix hotel/motel): ~720 \u20ac\n\uD83C\uDF54 Vitto 13 giorni: ~600 \u20ac\n\uD83D\uDEE1\uFE0F Assicurazione viaggio completa (Allianz/Unipol, 6pp): ~130 \u20ac\n\uD83D\uDCCA Totale stimato: ~2.710\u20132.910 \u20ac a persona.',
    itinerary: [
      'Volo Italia \u2192 Toronto (YYZ), trasferimento in hotel, cena libera e pernottamento.',
      'Toronto \u2192 Cascate del Niagara \u2013 sosta a Niagara-on-the-Lake, mini-crociera Hornblower, eventuale sorvolo in elicottero, pernottamento a Niagara Falls.',
      'Rientro a Toronto (city tour panoramico) e partenza per Ottawa, arrivo e pernottamento.',
      'Visita di Ottawa (Parlamento, ByWard Market, Rideau Canal) e trasferimento a Montr\u00e9al, cena e pernottamento.',
      'Visita guidata di Montr\u00e9al (Centro, Mont Royal, Oratorio di San Giuseppe, Basilica Notre-Dame, Parco Olimpico), poi trasferimento a Qu\u00e9bec City.',
      'Visita guidata di Qu\u00e9bec City (Vecchia Citt\u00e0, Castello Frontenac, Place Royale), proseguimento alle Cascate di Montmorency.',
      'Lungo trasferimento Qu\u00e9bec \u2192 Boston attraverso Vermont e New Hampshire, arrivo e pernottamento zona Boston.',
      'Visita di Boston (Boston Common, Freedom Trail, Faneuil Hall, Beacon Hill), poi Cape Cod affacciato sull\u2019Atlantico, quindi pernottamento a New Haven.',
      'New Haven \u2192 Lancaster (Pennsylvania Dutch Country) \u2013 visita di una fattoria Amish, carrozze, mulini, tradizioni immutate da secoli.',
      'Lancaster \u2192 Washington DC \u2013 visita panoramica di Campidoglio, Casa Bianca, Lincoln Memorial, Vietnam Veterans Memorial, National Mall.',
      'Washington \u2192 Philadelphia (Independence Hall esterno, Liberty Bell) \u2192 New York \u2013 arrivo a Midtown, Columbus Circle, Rockefeller Center, Times Square, Broadway.',
      'New York \u2013 Brooklyn Bridge, Wall Street, Chinatown, Little Italy, SoHo, Greenwich Village, salita all\u2019Empire State Building, tempo libero.',
      'Mattinata libera a New York, poi trasferimento a JFK e volo di rientro per l\u2019Italia.',
    ]
  },
  { name: 'Thailandia',                  flag: '\u{1F1F9}\u{1F1ED}', days: 15,
    desc: 'Koh Samui con le spiagge di Chaweng e Lamai, le cascate nella giungla, i templi dorati e il mercato dei pescatori di Bophut. L\u2019escursione nel parco marino di Ang Thong (kayak, trekking, snorkeling) e una puntata a Koh Tao per le acque cristalline. 15 giorni di mare, calore e ritmo lento. Il sud della Thailandia senza fretta e senza folla.\n\n\u{1F5FA}\uFE0F Spostamenti: traghetti inter-isola + taxi/scooter\n\n\u{1F4B0} Costo stimato per persona (gruppo di 6, luglio\u2013agosto):\n\u2708\uFE0F Volo A/R MXP\u2192BKK\u2192USM (Koh Samui, scalo Bangkok): ~780 \u20ac\n\u26F5 Traghetti Samui\u2194Koh Tao + escursioni barca: ~80 \u20ac\n\uD83C\uDFE8 Alloggio 14 notti (3 camere, bungalow/hotel): ~560 \u20ac\n\uD83C\uDF7D\uFE0F Vitto 15 giorni (Thailandia \u00e8 economica): ~350 \u20ac\n\uD83C\uDF0A Escursioni guidate (Ang Thong, Koh Nang Yuan): ~120 \u20ac\n\uD83D\uDEE1\uFE0F Assicurazione viaggio completa (Allianz/Unipol, 6pp): ~70 \u20ac\n\uD83D\uDC89 Profilassi & vaccini (non incl. nel totale): epatite A e tifoidea raccomandate; antimalarica NON necessaria per Koh Samui e le isole. Nessun vaccino obbligatorio dall\u2019Italia.\n\uD83D\uDCCA Totale stimato: ~1.960\u20132.160 \u20ac a persona.',
    itinerary: [
      'Volo Italia \u2192 Bangkok \u2192 Koh Samui, arrivo, check-in, primo tramonto sulla spiaggia.',
      'Koh Samui \u2013 Mare e relax a Chaweng Beach, serata tra ristoranti di pesce e locali sul lungomare.',
      'Koh Samui \u2013 Spiaggia di Lamai, Hin Ta & Hin Yai (rocce caratteristiche), viewpoint al tramonto sulla costa.',
      'Koh Samui \u2013 Escursione alle cascate Na Muang (prima e seconda cascata) e interno dell\u2019isola con giungla.',
      'Koh Samui \u2013 Templi Wat Phra Yai (Big Buddha di 12 metri) e Wat Plai Laem, pomeriggio e aperitivo a Bophut Fisherman\u2019s Village.',
      'Koh Samui \u2013 Wat Khunaram (monaco mummificato), spiagge tranquille a Taling Ngam e Lipa Noi, tramonto sulla costa ovest.',
      'Koh Samui \u2013 Escursione full day al Parco Marino di Ang Thong: trekking, kayak tra le lagune, snorkeling, panorama dall\u2019alto.',
      'Koh Samui \u2013 Giornata libera: mare, spa thailandese, shopping al Fisherman\u2019s Village, eventuale corso di cucina thai.',
      'Koh Tao \u2013 Traghetto mattutino, check-in a Sairee Beach, snorkeling pomeridiano e tramonto sull\u2019isola.',
      'Koh Tao \u2013 Giornata in barca: snorkeling a Shark Bay, Japanese Garden, tappa a Koh Nang Yuan (vista panoramica iconica).',
      'Koh Tao \u2192 Koh Samui \u2013 Mattina libera sull\u2019isola, traghetto di rientro nel pomeriggio.',
      'Koh Samui \u2013 Jungle Club con piscina a sfioro, vista panoramica sull\u2019intera isola, pranzo e relax.',
      'Koh Samui \u2013 Ultime spiagge, shopping souvenir, cena finale sulla spiaggia con i piedi nella sabbia.',
      'Koh Samui \u2013 Partenza da Samui (USM), voli di rientro verso l\u2019Italia via Bangkok.',
      'Arrivo in Italia.',
    ]
  },
  { name: 'Per\u00f9',                         flag: '\u{1F1F5}\u{1F1EA}', days: 15,
    desc: 'Cusco barocca e inca, il Machu Picchu all\u2019alba in treno panoramico, la Rainbow Mountain coi suoi strati di colori alieni, e il Lago Titicaca con le isole galleggianti degli Uros. 15 giorni sulle Ande a oltre 3.400 m di quota, tra rovine millenarie, mercati coloratissimi e paesaggi che non esistono da nessun\u2019altra parte. Il viaggio che fa sentire piccoli \u2013 nel modo migliore.\n\n\u{1F5FA}\uFE0F Spostamenti: treno + bus + voli interni\n\n\u{1F4B0} Costo stimato per persona (gruppo di 6):\n\u2708\uFE0F Volo A/R MXP\u2192LIM (scalo): ~1.050 \u20ac\n\u2708\uFE0F Volo interno LIM\u2192CUZ + PUQ\u2192LIM: ~200 \u20ac\n\uD83D\uDE82 Treno Cusco\u2194Aguas Calientes (Vistadome): ~80 \u20ac\n\uD83C\uDFE8 Alloggio 14 notti (3 camere, mix hotel/lodge): ~640 \u20ac\n\uD83C\uDF7D\uFE0F Vitto 15 giorni: ~420 \u20ac\n\uD83C\uDFDE\uFE0F Ingressi parchi e siti (Machu Picchu \u00d72, Rainbow Mtn, Titicaca): ~130 \u20ac\n\uD83D\uDEE1\uFE0F Assicurazione viaggio completa (Allianz/Unipol, 6pp): ~70 \u20ac\n\uD83D\uDC89 Profilassi & vaccini (non incl. nel totale): epatite A, tifoidea raccomandate; mal di montagna probabile a Cusco (3.400 m) \u2013 Diamox (acetazolamide) 2\u20133 giorni prima; antimalarica solo se si aggiungono zone amazzoniche. Nessun vaccino obbligatorio dall\u2019Italia per l\u2019itinerario classico.\n\uD83D\uDCCA Totale stimato: ~2.590\u20132.790 \u20ac a persona.',
    itinerary: [
      'Volo Italia \u2192 Lima \u2192 Cusco (3.400 m), arrivo, check-in, passeggiata leggera in centro per l\u2019acclimatamento.',
      'Cusco \u2013 Visita tranquilla della citt\u00e0: Plaza de Armas, Qorikancha (tempio del Sole inca), quartiere di San Blas, mercatini artigianali.',
      'Cusco e dintorni \u2013 Siti archeologici: Sacsayhu\u00e1m\u00e1n (fortezza inca), Q\u2019enqo, Puca Pucara, Tambomachay.',
      'Valle Sacra \u2013 Pisac (rovine panoramiche + mercato indigeno coloratissimo) e Ollantaytambo (fortezza inca imponente), notte in Valle Sacra.',
      'Machu Picchu \u2013 Treno panoramico Vistadome verso Aguas Calientes, visita guidata della citt\u00e0 perduta degli Inca, notte ad Aguas Calientes.',
      'Aguas Calientes \u2013 Secondo ingresso a Machu Picchu all\u2019alba (luce diversa, meno folla) oppure relax alle terme, rientro a Cusco in treno.',
      'Rainbow Mountain (Vinicunca, 5.200 m) \u2013 trekking full day tra le Ande, strati di minerali colorati, alpaca e condor. Rientro a Cusco.',
      'Cusco \u2013 Giornata di recupero: Museo de Arte Precolombino, mercato di San Pedro, shopping, artigianato andino, relax.',
      'Cusco \u2192 Puno / Arequipa \u2013 Bus panoramico o volo, arrivo, sistemazione. Opzione A: Puno e Lago Titicaca; Opzione B: Arequipa (citt\u00e0 bianca).',
      'Opzione A: Lago Titicaca \u2013 Isole galleggianti degli Uros (canne totora), Taquile con i tessitori tradizionali. Opzione B: Canyon del Colca (condor), Yanque.',
      'Opzione A: Seconda giornata sul Titicaca o relax a Puno. Opzione B: Arequipa \u2013 Monastero di Santa Catalina, Plaza de Armas, cucina peruviana.',
      'Volo Puno/Arequipa \u2192 Lima, arrivo, check-in a Miraflores, passeggiata sul Mal\u00e9con affacciato sul Pacifico.',
      'Lima \u2013 Centro storico (Plaza Mayor, Cattedrale, Convento di San Francisco con catacombs), Larco Mar, quartiere di Barranco.',
      'Lima \u2013 Mattina libera, pranzo in un ristorante gastronomico peruviano (Lima \u00e8 tra le prime citt\u00e0 culinarie al mondo), poi aeroporto.',
      'Volo Lima \u2192 Italia, arrivo.',
    ]
  },
];


let destIndex    = 0;
let destRatings  = {};
let weightValues = {};
let currentUser  = '';

const SCREEN_IDS = ['name', 'welcome', 'dest', 'weights', 'joke', 'results', 'leaderboard'];

function showScreen(id) {
  SCREEN_IDS.forEach(s => document.getElementById('screen-' + s).classList.toggle('active', s === id));
  window.scrollTo(0, 0);
  const showProg = id === 'dest' || id === 'weights';
  document.getElementById('progressWrap').style.display = showProg ? 'block' : 'none';
  if (showProg) updateProgress(id);
}

function updateProgress(screenId) {
  const total = DESTINATIONS.length + 1;
  const done  = screenId === 'weights' ? DESTINATIONS.length : destIndex;
  const pct   = Math.round((done / total) * 100);
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressCount').textContent = screenId === 'weights' ? 'Pesi' : (destIndex + 1) + ' / ' + DESTINATIONS.length;
  document.getElementById('progressText').textContent  = screenId === 'weights' ? 'Ultima cosa...' : DESTINATIONS[destIndex].name;
}

function startWithName() {
  var n = document.getElementById('nameInput').value.trim();
  if (!n) {
    document.getElementById('nameInput').focus();
    document.getElementById('nameInput').style.borderColor = '#f88';
    setTimeout(function() { document.getElementById('nameInput').style.borderColor = ''; }, 1200);
    return;
  }
  currentUser = n;
  showScreen('welcome');
}

function startDestinations() {
  destIndex = 0; destRatings = {}; weightValues = {};
  renderDest(); showScreen('dest');
}

function renderDest() {
  const dest = DESTINATIONS[destIndex];
  var oldItin = document.getElementById('itinArea');
  if (oldItin) oldItin.remove();
  document.getElementById('destHeader').innerHTML =
    '<div class="dest-flag">' + destFlagImg(dest.name, 52) + '</div>' +
    '<div class="dest-info">' +
      '<div class="dest-name">' + dest.name + '</div>' +
      '<div class="dest-days">&#x1F4C5; ' + dest.days + ' giorni</div>' +
      '<div class="dest-desc">' + dest.desc.replace(/\n\n/g, '<br><br>') + '</div>' +
    '</div>';

  // Itinerario sezione
  var itinHtml = '<button class="itin-toggle" onclick="toggleItin()">&#x1F4CB; Vedi itinerario giorno per giorno</button>' +
    '<div class="itin-section" id="itinSection">' +
    dest.itinerary.map(function(d, i) {
      return '<div class="itin-day"><div class="itin-num">G' + (i + 1) + '</div><div class="itin-text">' + d + '</div></div>';
    }).join('') +
    '</div>';
  document.getElementById('destHeader').insertAdjacentHTML('afterend', '<div id="itinArea">' + itinHtml + '</div>');

  const saved = destRatings[destIndex] || {};
  document.getElementById('dest-params').innerHTML = PARAMS.map(function(p) {
    var stars = [1,2,3,4,5].map(function(v) {
      return '<div class="star' + (saved[p.id] === v ? ' selected' : '') + '" onclick="setDestParam(\'' + p.id + '\',' + v + ')">' + v + '</div>';
    }).join('');
    return '<div class="param-card">' +
      '<div class="param-label"><span>' + p.emoji + '</span>' + p.label + (p.id === 'sex' ? ' <button class="sex-info-btn" onclick="showSexInfo(' + destIndex + ')" title="Dettagli">&#x2139;&#xFE0F;</button>' : '') + '<span class="param-hint">' + p.hint + '</span></div>' +
      '<div class="stars" id="dstars-' + p.id + '">' + stars + '</div>' +
    '</div>';
  }).join('');

  document.getElementById('btn-prev-dest').style.display = destIndex === 0 ? 'none' : 'block';
  document.getElementById('btn-next-dest').textContent =
    destIndex === DESTINATIONS.length - 1 ? 'Avanti ai pesi \u2192' : 'Avanti \u2192';
  document.getElementById('dest-msg').textContent = '';
}

function toggleItin() {
  var s = document.getElementById('itinSection');
  if (s) s.classList.toggle('open');
}

function setDestParam(paramId, val) {
  if (!destRatings[destIndex]) destRatings[destIndex] = {};
  destRatings[destIndex][paramId] = val;
  document.querySelectorAll('#dstars-' + paramId + ' .star').forEach(function(s, i) {
    s.classList.toggle('selected', i + 1 === val);
  });
  document.getElementById('dest-msg').textContent = '';
  if (paramId === 'sex' && val === 5) {
    document.getElementById('sexModal').classList.add('open');
  }
}

function closeModal() {
  document.getElementById('sexModal').classList.remove('open');
}

function showSexInfo(idx) {
  var dest = DESTINATIONS[idx];
  var info = DEST_SEX_INFO[dest.name] || {};
  var figaLabel = FIGA_LABELS[info.figa] || '?';
  var darebbe = info.darebbe;
  document.getElementById('sexInfoTitle').textContent = '🔎 Sex Index – ' + dest.name;
  document.getElementById('sexInfoTable').innerHTML =
    '<tr><td><strong>Sex Index</strong></td><td><strong>' + ((DEST_STATS[dest.name] || {}).sex || '?') + ' / 5</strong></td></tr>' +
    '<tr><td>C\u2019\u00e8 figa?</td><td>' + figaLabel + '</td></tr>' +
    '<tr><td>Ce la darebbero?</td><td class="' + (darebbe ? 'sex-info-yes' : 'sex-info-no') + '">' + (darebbe ? 'SI 🤩' : 'NO 😔') + '</td></tr>';
  document.getElementById('sexInfoModal').classList.add('open');
}

function closeSexInfoModal() {
  document.getElementById('sexInfoModal').classList.remove('open');
}

function openMetePanel() {
  var body = document.getElementById('mete-panel-body');
  body.innerHTML = DESTINATIONS.map(function(d, i) {
    var st = DEST_STATS[d.name] || {};
    var statsHtml = '<div class="mete-stats">' +
      '<div class="mete-stats-title">📊 Report oggettivo</div>' +
      PARAMS.filter(function(p){ return p.id !== 'want'; }).map(function(p) {
        var infoBtn = p.id === 'sex' ? ' <button class="sex-info-btn" onclick="showSexInfo(' + i + ')" title="Dettagli scopabilit\u00e0">\u2139\uFE0F</button>' : '';
        return '<div class="mete-stat-row">' +
          '<div class="mete-stat-label"><span>' + p.emoji + '</span>' + p.label + infoBtn + '</div>' +
          renderStatBar(st[p.id] || 0) +
        '</div>';
      }).join('') +
    '</div>';
    return '<div class="mete-card">' +
      '<div class="mete-card-title">' + destFlagImg(d.name, 26) + ' ' + d.name + '</div>' +
      '<div class="mete-card-days">&#x1F4C5; ' + d.days + ' giorni</div>' +
      '<div class="mete-card-desc">' + d.desc + '</div>' +
      statsHtml +
      '<button class="mete-itin-toggle" onclick="toggleMeteItin(' + i + ')">' +
        '&#x1F4CB; Itinerario <span id="mia-' + i + '">▼</span>' +
      '</button>' +
      '<ul class="mete-itin-list" id="mil-' + i + '">' +
        d.itinerary.map(function(step, j) {
          return '<li><span class="mete-day-num">Giorno ' + (j + 1) + '</span>' + step + '</li>';
        }).join('') +
      '</ul>' +
    '</div>';
  }).join('');
  document.getElementById('metePanel').classList.add('open');
  document.getElementById('metePanel').scrollTop = 0;
}

function closeMetePanel() {
  document.getElementById('metePanel').classList.remove('open');
}

function toggleMeteItin(i) {
  var list  = document.getElementById('mil-' + i);
  var arrow = document.getElementById('mia-' + i);
  list.classList.toggle('open');
  arrow.textContent = list.classList.contains('open') ? '▲' : '▼';
}

function nextDest() {
  var ratings = destRatings[destIndex] || {};
  var missing = PARAMS.filter(function(p) { return !ratings[p.id]; });
  if (missing.length) {
    document.getElementById('dest-msg').textContent = 'Valuta ancora: ' + missing.map(function(p) { return p.label; }).join(', ');
    return;
  }
  if (destIndex < DESTINATIONS.length - 1) {
    destIndex++; renderDest(); updateProgress('dest');
  } else {
    buildWeights(); showScreen('weights');
  }
}

function prevDest() {
  if (destIndex > 0) { destIndex--; renderDest(); updateProgress('dest'); }
  else { showScreen('welcome'); }
}

function buildWeights() {
  document.getElementById('weights-container').innerHTML = PARAMS.filter(function(p) { return !p.alwaysMax; }).map(function(p) {
    var btns = [1,2,3,4,5].map(function(v) {
      return '<div class="wbtn" onclick="setWeight(\'' + p.id + '\',' + v + ')">' + v + '</div>';
    }).join('');
    return '<div class="weight-card"><div class="weight-card-label">' + p.emoji + ' ' + p.label + '</div><div class="weight-btns" id="wbtns-' + p.id + '">' + btns + '</div></div>';
  }).join('') +
  '<div style="margin-top:14px;background:rgba(255,215,0,0.08);border:1px solid rgba(255,215,0,0.25);border-radius:12px;padding:11px 14px;font-size:0.76rem;color:#ffd;opacity:0.85;line-height:1.5;">' +
    '\u{1F929} <strong>Quanto ci vuoi andare</strong> ha sempre il peso massimo automaticamente.' +
  '</div>';
  weightValues = {};
  document.getElementById('weights-msg').textContent = '';
}

function setWeight(id, val) {
  var used = Object.entries(weightValues).filter(function(e) { return e[0] !== id; }).map(function(e) { return e[1]; });
  if (used.includes(val)) return;
  weightValues[id] = val;
  refreshWeightButtons();
  document.getElementById('weights-msg').textContent = '';
}

function refreshWeightButtons() {
  var allUsed = Object.values(weightValues);
  PARAMS.filter(function(p) { return !p.alwaysMax; }).forEach(function(p) {
    var chosen = weightValues[p.id];
    document.querySelectorAll('#wbtns-' + p.id + ' .wbtn').forEach(function(btn) {
      var v = parseInt(btn.textContent);
      btn.className = 'wbtn' + (v === chosen ? ' selected' : (!chosen || !allUsed.includes(v) ? '' : ' used'));
    });
  });
}

function backToLastDest() {
  destIndex = DESTINATIONS.length - 1; renderDest(); showScreen('dest');
}

function calcResults() {
  var weightedParams = PARAMS.filter(function(p) { return !p.alwaysMax; });
  var alwaysMaxParams = PARAMS.filter(function(p) { return p.alwaysMax; });
  var missing = weightedParams.filter(function(p) { return !weightValues[p.id]; });
  if (missing.length) {
    document.getElementById('weights-msg').textContent = 'Assegna importanza a: ' + missing.map(function(p) { return p.label; }).join(', ');
    return;
  }
  var maxWeight    = Math.max.apply(null, weightedParams.map(function(p) { return weightValues[p.id]; }));
  var totalWeight  = weightedParams.reduce(function(s, p) { return s + weightValues[p.id]; }, 0) + alwaysMaxParams.length * maxWeight;
  var maxScore     = 5 * totalWeight;
  var scored = DESTINATIONS.map(function(dest, idx) {
    var ratings = destRatings[idx] || {};
    var score = weightedParams.reduce(function(s, p) { return s + (ratings[p.id] || 1) * weightValues[p.id]; }, 0);
    score += alwaysMaxParams.reduce(function(s, p) { return s + (ratings[p.id] || 1) * maxWeight; }, 0);
    return Object.assign({}, dest, { ratings: ratings, score: score, pct: Math.round((score / maxScore) * 100) });
  });
  scored.sort(function(a, b) { return b.score - a.score; });
  pendingResults = scored;

  // Mostra scherzo prima dei risultati reali
  var joke = JOKE_DESTS[Math.floor(Math.random() * JOKE_DESTS.length)];
  document.getElementById('jokeFlag').innerHTML = flagImg(JOKE_CODES[joke.name] || '', 64);
  document.getElementById('jokeName').textContent = joke.name;
  document.getElementById('jokeFallbackEmoji').textContent = joke.emoji;
  var img = document.getElementById('jokeImg');
  var fallback = document.getElementById('jokeImgFallback');
  img.style.display = 'block';
  fallback.style.display = 'none';
  img.src = joke.img;
  showScreen('joke');
}

function showRealResults() {
  renderResults(pendingResults);
  var btn = document.getElementById('btnSalva');
  btn.disabled = false;
  btn.textContent = '\u{1F4BE} Salva e vedi classifica';
  showScreen('results');
}

var pendingResults = null;

var JOKE_DESTS = [
  { name: 'Catanzaro Lido', flag: '\u{1F1EE}\u{1F1F9}', emoji: '\u{1F3D6}\uFE0F',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/1e/Catanzaro_Lido.jpg/800px-Catanzaro_Lido.jpg' },
  { name: 'Tel Aviv', flag: '\u{1F1EE}\u{1F1F1}', emoji: '\u{1F3D9}\uFE0F',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/aa/Tel_aviv_-_gordon_beach.jpg/800px-Tel_aviv_-_gordon_beach.jpg' },
  { name: 'Palestina', flag: '\u{1F1F5}\u{1F1F8}', emoji: '\u{1F54C}',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/dc/Gaza_market.jpg/800px-Gaza_market.jpg' },
  { name: 'Nuova Delhi', flag: '\u{1F1EE}\u{1F1F3}', emoji: '\u{1F9F1}',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/India_Gate_in_New_Delhi.jpg/800px-India_Gate_in_New_Delhi.jpg' },
];

var MEDALS = ['\u{1F947}', '\u{1F948}', '\u{1F949}'];

function renderResults(scored) {
  document.getElementById('results-container').innerHTML = scored.map(function(dest, i) {
    var cls   = i === 0 ? 'top1' : i === 1 ? 'top2' : i === 2 ? 'top3' : '';
    var medal = MEDALS[i] || '#' + (i + 1);
    var bars  = PARAMS.map(function(p) {
      var v = dest.ratings[p.id] || 0;
      return '<div class="bar-row"><div class="bar-label">' + p.emoji + ' ' + p.label + '</div><div class="bar-track"><div class="bar-fill" style="width:' + (v * 20) + '%"></div></div><div>' + v + '/5</div></div>';
    }).join('');
    return '<div class="result-card ' + cls + '">' +
      '<div class="result-rank">' + medal + '</div>' +
      '<div class="result-name">' + destFlagImg(dest.name, 28) + ' ' + dest.name + '</div>' +
      '<div class="result-meta">&#x1F4C5; ' + dest.days + ' giorni</div>' +
      '<div class="result-desc">' + dest.desc.replace(/\n\n/g, '<br><br>') + '</div>' +
      '<div class="result-score-bar"><div class="result-score-fill" style="width:' + dest.pct + '%"></div></div>' +
      '<div class="result-pct">Punteggio: ' + dest.pct + '%</div>' +
      '<div class="result-bars">' + bars + '</div>' +
    '</div>';
  }).join('');
}

function resetAll() {
  destIndex = 0; destRatings = {}; weightValues = {}; currentUser = '';
  document.getElementById('nameInput').value = '';
  showScreen('name');
}

// ── JSONBIN DATABASE ─────────────────────────────────────────────

async function dbFetch() {
  var r = await fetch(JB_API + '/latest', {
    headers: { 'X-Master-Key': JB_KEY }
  });
  if (!r.ok) throw new Error('Impossibile leggere il database (status ' + r.status + ')');
  var j = await r.json();
  return j.record;
}

async function dbWrite(data) {
  var r = await fetch(JB_API, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
      'X-Master-Key': JB_KEY
    },
    body: JSON.stringify(data)
  });
  if (!r.ok) throw new Error('Errore nel salvataggio (status ' + r.status + ')');
}

async function saveAndShowLeaderboard() {
  if (!pendingResults) return;
  var btn = document.getElementById('btnSalva');
  btn.disabled = true;
  btn.textContent = '\u23F3 Salvataggio in corso...';
  try {
    var top = pendingResults[0];
    var data = await dbFetch();
    data.results.push({
      name: currentUser,
      dest: top.name,
      flag: top.flag,
      code: DEST_CODES[top.name] || '',
      date: new Date().toISOString().slice(0, 10)
    });
    await dbWrite(data);
    await openLeaderboard();
  } catch(e) {
    btn.disabled = false;
    btn.textContent = '\u{1F4BE} Salva e vedi classifica';
    alert('\u26A0\uFE0F ' + e.message + '\n\nControlla JB_BIN_ID e JB_KEY nel file HTML.');
  }
}

async function openLeaderboard() {
  var el = document.getElementById('leaderboard-container');
  el.innerHTML = '<p style="opacity:0.5;text-align:center">\u23F3 Caricamento...</p>';
  showScreen('leaderboard');
  try {
    var data = await dbFetch();
    renderLeaderboard(data.results);
  } catch(e) {
    el.innerHTML = '<p style="color:#f88;opacity:0.9;font-size:0.85rem">\u26A0\uFE0F Errore: ' + e.message + '<br><br>Controlla JB_BIN_ID e JB_KEY nel file HTML.</p>';
  }
}

function renderLeaderboard(results) {
  var el = document.getElementById('leaderboard-container');
  if (!results || results.length === 0) {
    el.innerHTML = '<p style="opacity:0.5;text-align:center">Nessun risultato ancora.\u{1F4A4}<br>Sii il primo! \u{1F680}</p>';
    return;
  }

  // Conteggio per destinazione
  var counts = {};
  results.forEach(function(r) {
    if (!counts[r.dest]) counts[r.dest] = { count: 0, flag: r.flag };
    counts[r.dest].count++;
    counts[r.dest].flag = r.flag;
  });
  var ranking = Object.keys(counts).map(function(k) {
    return { dest: k, flag: counts[k].flag, count: counts[k].count };
  }).sort(function(a, b) { return b.count - a.count; });
  var maxCount = ranking[0].count;

  var html = '<div class="lb-section-title">\u{1F4CA} Classifica destinazioni</div>';
  ranking.forEach(function(r, i) {
    var medal = ['\u{1F947}','\u{1F948}','\u{1F949}'][i] || '#'+(i+1);
    var pct = Math.round((r.count / maxCount) * 100);
    html += '<div class="lb-rank-row">' +
      '<div class="lb-medal">' + medal + '</div>' +
      '<div class="lb-rank-info">' +
        '<div class="lb-rank-name">' + flagImg(r.code || '', 22) + ' ' + r.dest + '</div>' +
        '<div class="lb-bar-wrap"><div class="lb-bar-fill" style="width:' + pct + '%"></div></div>' +
      '</div>' +
      '<div class="lb-count">' + r.count + (r.count === 1 ? ' voto' : ' voti') + '</div>' +
    '</div>';
  });

  // Lista utenti
  html += '<div class="lb-section-title" style="margin-top:24px">\u{1F465} Tutti i partecipanti</div>';
  var sorted = results.slice().sort(function(a,b) { return b.date.localeCompare(a.date); });
  sorted.forEach(function(r) {
    html += '<div class="lb-user-row">' +
      '<div class="lb-user-name">\u{1F464} ' + r.name + '</div>' +
      '<div class="lb-user-dest">' + flagImg(r.code || '', 18) + ' ' + r.dest + '</div>' +
      '<div class="lb-user-date">' + r.date + '</div>' +
    '</div>';
  });

  el.innerHTML = html;
}
</script>
</body>
</html>
